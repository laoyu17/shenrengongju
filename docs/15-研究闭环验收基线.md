# 研究闭环验收基线（DoD）

## 0. 文档控制
- 版本：v0.1
- 日期：2026-02-22
- 适用范围：`project/` 当前主干实现
- 关联：`docs/14-docx需求追踪矩阵.md`

## 1. 目标与范围

本文定义“研究闭环”在当前项目中的**机器可判定标准**，用于统一评审口径，避免“已实现/增强中”语义漂移。

- 评审入口：`rtos-sim run ... --audit-out <path>` 产出的 `compliance_profiles`
- 判定对象：协议一致性、资源终止路径、死锁与证明辅助轨迹
- 非目标：性能优化（本轮明确不作为达标条件）

## 2. 合规画像定义

### 2.1 engineering_v1（工程交付基线）
- 必过检查：
  - `resource_release_balance`
  - `abort_cancel_release_visibility`
  - `resource_partial_hold_on_block`
  - `wait_for_deadlock`
- 用途：工程回归、CI 快速门禁

### 2.2 research_v1（研究复现基线）
- 必过检查：
  - `resource_release_balance`
  - `abort_cancel_release_visibility`
  - `pcp_priority_domain_alignment`
  - `pcp_ceiling_numeric_domain`
  - `resource_partial_hold_on_block`
  - `pip_priority_chain_consistency`
  - `pcp_ceiling_transition_consistency`
  - `wait_for_deadlock`
  - `pip_owner_hold_consistency`
- 用途：论文/报告级实验的语义闭环判定

### 2.3 判定规则
- `compliance_profiles.profiles.<profile>.status == "pass"`：画像通过
- `failed_checks` 非空：画像失败，必须给出失败样例与修复说明
- `missing_checks` 非空：视为失败（禁止“规则未执行”绕过）

## 3. 执行与取证流程

1. 模型校验
   - `rtos-sim validate -c <config>`
2. 运行并导出审计
   - `rtos-sim run -c <config> --audit-out artifacts/audit.json --metrics-out artifacts/metrics.json --events-out artifacts/events.jsonl`
3. 导出模型关系
   - `rtos-sim inspect-model -c <config> --out-json artifacts/model_relations.json --out-csv artifacts/model_relations.csv`
4. 固化质量快照（测试/覆盖率）
   - `python scripts/quality_snapshot.py --output artifacts/quality/quality-snapshot.json --coverage-json artifacts/quality/coverage.json`
5. 评审结论
   - `research_v1.status`、`engineering_v1.status`
   - `model_relations.status`
   - `quality_snapshot.pytest.passed` 与 `quality_snapshot.coverage.line_rate`

## 4. 需求映射（Docx M-条目）

| Docx 条目 | 主要判定入口 | 说明 |
|---|---|---|
| M-03 资源协议语义 | `research_v1` + `protocol_proof_assets` | 关注 PIP/PCP 一致性与 owner 链路 |
| M-08 随机到达模型 | `validate + run + audit` | 当前支持 `fixed/uniform/poisson/one_shot/custom`，后续扩展模板库 |
| M-09 时间确定性 | `research_v1` + `inspect-model` | 关注确定性窗口一致性与关系闭环 |

## 5. 当前基线（2026-02-22）

- 自动化测试：`211 passed`
- 总覆盖率：`87%`
- 审计报告字段：已包含 `rule_version`、`evidence`、`protocol_proof_assets`、`compliance_profiles`
- 结论：研究闭环已具备机读判定入口，后续重点转向“反例集深度 + 模板化报告”

## 6. 后续迭代建议

- 增加 research_v1 反例基准集（多锁链、PCP 天花板边界、混合到达过程）
- 将 `research_v1` 判定接入 CI 非阻断报告，稳定后再评估门禁级别
- 补充模板化审计报告（面向评审/论文附录直接引用）

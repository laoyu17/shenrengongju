# 时序图与类图（Mermaid/UML 草案）

## 1. 任务释放与分段执行时序图

```mermaid
sequenceDiagram
    participant UI as UI
    participant APP as 控制器
    participant SIM as 仿真引擎
    participant SCH as 调度器
    participant RES as 资源协议
    participant LOG as 事件日志

    UI->>APP: 运行仿真
    APP->>SIM: build(spec)
    APP->>SIM: run(until)

    SIM->>SCH: on_release(job)
    SCH-->>SIM: schedule(decisions)
    SIM->>LOG: JobReleased

    SIM->>RES: request(segment, resource)
    RES-->>SIM: grant
    SIM->>LOG: ResourceAcquire

    SIM->>LOG: SegmentStart
    SIM->>LOG: SegmentEnd

    RES-->>SIM: release
    SIM->>LOG: ResourceRelease

    SIM->>SCH: on_complete(job)
    SCH-->>SIM: schedule(decisions)
    SIM->>LOG: JobComplete
```

## 2. 抢占与迁移时序图（简化）

```mermaid
sequenceDiagram
    participant SIM as 仿真引擎
    participant SCH as 调度器
    participant LOG as 事件日志

    SIM->>SCH: on_release(high_priority_job)
    SCH-->>SIM: schedule(preempt)
    SIM->>LOG: Preempt
    SIM->>LOG: Migrate
```

## 3. 领域模型类图（草案）

```mermaid
classDiagram
    class ModelSpec {
        +version
        +platform
        +resources
        +tasks
        +scheduler
        +sim
    }

    class ProcessorType {
        +id
        +name
        +core_count
        +speed_factor
    }

    class Core {
        +id
        +type_id
        +speed_factor
    }

    class Resource {
        +id
        +name
        +bound_core_id
        +protocol
    }

    class TaskGraph {
        +id
        +name
        +task_type
        +period
        +deadline
        +arrival
        +abort_on_miss
    }

    class Subtask {
        +id
        +predecessors
        +successors
    }

    class Segment {
        +id
        +index
        +wcet
        +acet
        +required_resources
        +mapping_hint
    }

    ModelSpec --> ProcessorType
    ModelSpec --> Core
    ModelSpec --> Resource
    ModelSpec --> TaskGraph
    TaskGraph --> Subtask
    Subtask --> Segment
```

## 4. SimPy 映射关系（说明）
- Environment: 全局仿真时间基准
- Task/Segment: 可映射为进程协程
- Resource: 映射为 SimPy Resource/PreemptiveResource
- Scheduler: 驱动进程调度决策

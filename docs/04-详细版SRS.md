# 详细版需求规格说明书（RTOS 多核异构调度仿真工具）

## 0. 文档控制
- 版本：v0.1
- 状态：草案
- 负责人：待定
- 更新日期：2026-02-01

## 1. 引言
### 1.1 背景与问题陈述
面向多核异构处理器与混合实时性任务，需要一个可视化、可配置、可复现的调度仿真工具，支持任务 DAG、子任务分段、资源互斥与绑定、抢占/迁移等核心行为。

### 1.2 目标
- 提供对调度算法与资源访问协议的快速仿真与对比
- 支持可视化展示与统计分析
- 具备可扩展性与可复现性

### 1.3 范围
- 包含：模型配置、仿真引擎、调度策略、统计分析、GUI
- 不包含：真实系统代码生成与部署

### 1.4 术语与缩略语
- DAG、Segment、WCET/ACET、Hyper-Period、Resource Binding

### 1.5 参考资料
- `250909-仿真工具-基础模型.docx`

## 2. 总体描述
### 2.1 系统上下文
输入模型配置，输出事件日志、指标统计与可视化结果。

### 2.2 用户角色
- 算法研究者：对比调度策略
- 系统工程师：验证任务可行性
- 教学演示用户：可视化展示调度过程

### 2.3 运行环境
- 桌面端（Windows/Linux）
- Python 运行时（建议 3.10+）

### 2.4 约束与假设
- 任务为 DAG，子任务按分段顺序执行
- 资源互斥访问且可绑定核
- 支持抢占与迁移

## 3. SimPy 引入与架构影响
### 3.1 适用性分析
- SimPy 提供离散事件仿真与进程协作模型，适合调度仿真。
- 环境（Environment）作为全局时间基准，任务/段可映射为进程。
- 资源模型（Resource/PreemptiveResource/PriorityResource）可用于互斥与抢占。

### 3.2 架构影响
- 仿真引擎需围绕 SimPy Environment 组织时间推进。
- 任务/段执行可封装为协程流程，调度器控制进入/退出与抢占。
- 事件日志与统计需在 SimPy 事件点挂钩（开始/结束/阻塞/唤醒）。

### 3.3 风险
- 复杂抢占与段级调度可能需要自定义调度器，而非直接使用标准 Resource。
- 事件粒度细化会导致性能压力，需要批量统计与可视化采样策略。

## 4. 功能需求（详细分解）
### 4.1 配置与校验
- FR-1：支持模型配置导入/导出
- FR-2：合法性校验（ID 唯一性、DAG 无环性、资源绑定正确性）
- FR-3：提供默认值与模板

### 4.2 仿真控制
- FR-4：运行/暂停/重置/单步/加速
- FR-5：支持固定随机种子

> FR-4 口径澄清（2026-02-18）：此处“加速”指仿真回放/交互控制层的时间推进速率，不等同于算法或引擎性能优化目标。

### 4.3 调度与执行
- FR-6：调度策略插件化加载
- FR-7：段级执行与抢占/迁移
- FR-8：资源访问与阻塞/唤醒
- FR-9：支持混合实时性（时间确定性/动态实时/非实时）

### 4.4 统计与分析
- FR-10：响应时间、超期率、抢占/迁移次数、核利用率
- FR-11：事件日志导出（CSV/JSON）

### 4.5 可视化
- FR-12：Gantt/时间线
- FR-13：指标面板与对比视图

## 5. 数据需求
- ProcessorType、Core、Resource、TaskGraph、Subtask、Segment
- 属性：WCET、deadline、period、arrival、speed、resource binding

## 6. 非功能需求
- NFR-1：可扩展性（策略、协议、ETM 插件）
- NFR-2：可复现性（同配置同结果）
- NFR-3：性能（大规模 DAG 仍可运行）
- NFR-4：可用性（UI 不阻塞）
- NFR-5：可测试性

## 7. 接口需求
- 配置文件接口（JSON/YAML）
- 插件接口（调度器/资源协议/ETM）
- 结果导出接口

## 8. 验收用例矩阵（草案）

| 用例ID | 场景 | 输入配置 | 操作步骤 | 期望输出 | 指标/验收标准 |
|---|---|---|---|---|---|
| AT-01 | 单 DAG + 单核 | 1 任务、2 子任务、分段无资源 | 运行仿真 | Gantt 正确 | 段顺序执行正确 |
| AT-02 | 资源互斥 | 2 任务争用同资源 | 运行仿真 | 存在阻塞 | 阻塞时间可统计 |
| AT-03 | 资源绑定 | 资源绑定核 A | 运行仿真 | 访问发生在核 A | 事件日志可验证 |
| AT-04 | 动态实时 | 周期任务+截止期 | 运行仿真 | 统计超期率 | 输出超期率 |
| AT-05 | 抢占/迁移 | 高优先级任务释放 | 运行仿真 | 发生抢占/迁移 | 抢占次数可统计 |
| AT-06 | 时间确定性 | 固定偏移配置 | 运行仿真 | 时序固定 | 超周期内重复一致 |
| AT-07 | 多核异构 | 不同 speed 核 | 运行仿真 | 执行时间缩放 | 统计一致 |

## 9. 风险与对策
- DAG + 资源绑定可能导致死锁，需要协议或检测机制
- 分段级事件多导致性能压力，需要采样或聚合

## 10. 开放问题
- 资源访问协议选型
- 配置格式与 Schema 细节
- ETM 精度与性能权衡
